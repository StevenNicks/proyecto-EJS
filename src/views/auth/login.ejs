<!doctype html>
<html lang="en">
<%- include('../partials/head') %>
   <link rel="stylesheet" href="/css/login.css">

   <body>
      <div class="container text-center">
         <div class="row">
            <div class="col">
               <!-- Content here -->
               <div class="container d-flex justify-content-center align-items-center min-vh-100">
                  <div class="row border rounded-5 p-3 bg-white shadow box-area" style="min-height: 520px;">
                     <div
                        class="col-md-6 rounded-4 d-flex justify-content-center align-items-center flex-column left-box"
                        style="background: #099584;">
                        <div class="featured-image mb-3">
                           <img src="/images/Vaccine development-bro.png" class="img-fluid" style="width: 300px;">
                        </div>
                        <p class="text-white fs-5 mb-1">¬°Hola de nuevo!</p>
                        <small class="text-white text-wrap text-center">
                           Ingresa tu correo y contrase√±a para empezar.
                        </small>
                     </div>
                     <div class="col-md-6 right-box">
                        <form id="loginForm" action="/api/auth/login" method="POST"
                           class="d-flex justify-content-between flex-column h-100 needs-validation" novalidate>
                           <div class="d-flex flex-column">
                              <div class="header-text mb-3 text-start">
                                 <h2 class="fw-bold">Hola de nuevo!</h2>
                                 <p class="mb-0">Nos alegramos de tenerte de vuelta.</p>
                              </div>
                              <!-- Nombre -->
                              <div class="input-group mb-3">
                                 <input type="text" class="form-control form-control-lg bg-light fs-6" disabled readonly
                                    style="border-color: transparent;">
                              </div>
                              <!-- Correo -->
                              <div class="input-group mb-3">
                                 <input type="text" class="form-control form-control-lg bg-light fs-6"
                                    placeholder="Correo electr√≥nico" name="email" autocomplete="username" required>
                              </div>
                              <!-- Contrase√±a -->
                              <div class="input-group mb-3">
                                 <input type="password" class="form-control form-control-lg bg-light fs-6"
                                    placeholder="Contrase√±a" name="password" autocomplete="current-password" required>
                              </div>
                              <!-- Confirmar contrase√±a -->
                              <div class="input-group mb-3">
                                 <input class="form-control form-control-lg bg-light fs-6" disabled readonly
                                    style="border-color: transparent;">
                              </div>
                           </div>
                           <div class="d-flex flex-column">
                              <div class="input-group mb-3">
                                 <button class="btn btn-lg w-100 fs-6" type="submit"
                                    style="background-color: #099584; color: #FFFFFF;">
                                    Iniciar sesi√≥n
                                 </button>
                              </div>
                              <div class="row">
                                 <small>¬øNo tienes cuenta? <a href="/api/auth/register">Reg√≠strate</a></small>
                              </div>
                           </div>
                        </form>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <%- include('../partials/scripts') %>
         <script>
            $(document).ready(function () {
               validarFormulario("#loginForm",
                  function (form) {
                     const email = $(form).find("input[name='email']").val().trim();
                     const password = $(form).find("input[name='password']").val().trim();
                     const $submitBtn = $(form).find("button[type='submit']");

                     $.ajax({
                        url: "/api/auth/login",
                        type: "POST",
                        data: { email, password },
                        beforeSend: function () {
                           // Deshabilitar bot√≥n y mostrar estado
                           $submitBtn.prop("disabled", true).text("Cargando...");
                        }
                     })
                        .done(function (response) {
                           console.log("‚úÖ Respuesta del servidor:", response);

                           if (response.success) {
                              alert("Inicio de sesi√≥n exitoso üéâ");
                              window.location.href = "/api/empleados"; // Redirige a dashboard
                           } else {
                              alert("‚ö†Ô∏è " + response.message);
                           }
                        })
                        .fail(function (xhr, status, error) {
                           console.error("‚ùå Error AJAX:", status, error);
                           alert("Hubo un error en el servidor. Intenta de nuevo.");
                        })
                        .always(function () {
                           // Restaurar bot√≥n
                           $submitBtn.prop("disabled", false).text("Iniciar sesi√≥n");
                        });
                  },
                  function (form) {
                     console.warn("‚ö†Ô∏è El formulario no es v√°lido.");
                     // Aqu√≠ podr√≠as mostrar un toast en lugar de alert
                  }
               );
            });
         </script>

   </body>

</html>