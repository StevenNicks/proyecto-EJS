<nav class="navbar navbar-expand-lg bg-body-tertiary shadow-sm bg-body-tertiary rounded">
   <div class="container-fluid">
      <a class="navbar-brand mx-3 d-flex align-items-center" href="#">
         <img src="/favicon.ico" alt="Logo" class="img-fluid me-2" width="24" height="24">
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
         aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
         <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
         <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
               <a class="nav-link" aria-current="tamizajes" href="/tamizajes">Tamizajes</a>
            </li>
            <li class="nav-item">
               <a class="nav-link disabled" aria-current="resultados" href="/resultados">Resultados</a>
            </li>
            <li class="nav-item">
               <a class="nav-link" aria-current="empleados" href="/empleados">Empleados</a>
            </li>
            <li class="nav-item">
               <a class="nav-link" aria-current="usuarios" href="/usuarios">Usuarios</a>
            </li>
            <li class="nav-item">
               <a class="nav-link" aria-current="roles" href="/roles">Roles</a>
            </li>
         </ul>
         <!-- Segundo dropdown (alineado a la derecha) -->
         <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
            <li class="nav-item dropdown">
               <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" role="button"
                  data-bs-toggle="dropdown" aria-expanded="false">
                  <i data-lucide="user-round" width="16" height="16" class="me-1"></i>
                  <%= user?.nombre || "Usuario" %>
               </a>
               <ul class="dropdown-menu dropdown-menu-end">
                  <li><a class="dropdown-item" href="#">Perfil</a></li>
                  <li><a class="dropdown-item" href="#">Configuración</a></li>
                  <li>
                     <hr class="dropdown-divider">
                  </li>
                  <li><a class="dropdown-item text-danger" href="#" id="logoutBtn">Cerrar sesión</a></li>
               </ul>
            </li>
         </ul>
      </div>
   </div>
</nav>

<script>
   document.addEventListener("DOMContentLoaded", () => {
      const logoutLink = document.querySelector("#logoutBtn");

      if (logoutLink) {
         logoutLink.addEventListener("click", async (e) => {
            e.preventDefault();

            const confirmLogout = confirm("¿Deseas cerrar sesión?");
            if (!confirmLogout) return;

            try {
               const response = await fetch("/auth/logout", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
               });

               const data = await response.json();

               if (data.success) {
                  window.location.href = "/auth/login";
               } else {
                  alert(data.message || "Error al cerrar sesión.");
               }
            } catch (error) {
               console.error("Error al cerrar sesión:", error);
               alert("Ocurrió un error al cerrar sesión.");
            }
         });
      }
   });
</script>